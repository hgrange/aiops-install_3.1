# ---------------------------------------------------------------------------------------------------------------------------------------------------"
# ---------------------------------------------------------------------------------------------------------------------------------------------------"
# ---------------------------------------------------------------------------------------------------------------------------------------------------"
# Install Script for Turbonomic KubeTurbo
#
# V3.1.1
#
# https://github.com/turbonomic/kubeturbo/wiki/Operator-Details
#
# ©2021 nikh@ch.ibm.com
# ---------------------------------------------------------------------------------------------------------------------------------------------------"
# ---------------------------------------------------------------------------------------------------------------------------------------------------"
# ---------------------------------------------------------------------------------------------------------------------------------------------------"
# ---------------------------------------------------------------------------------------------------------------------------------------------------"

source ./tools/0_global/99_config-global.sh
__getClusterFQDN
__getInstallPath

# ---------------------------------------------------------------------------------------------------------------------------------------------------"
# ---------------------------------------------------------------------------------------------------------------------------------------------------"
# Do Not Edit Below
# ---------------------------------------------------------------------------------------------------------------------------------------------------"
# ---------------------------------------------------------------------------------------------------------------------------------------------------"

#headerModuleFileBegin "Install Turbonomic " $0



# ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# PREREQUISITES
# ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
header3Begin "Running Prerequisites" "rocket"

        getInstallPath

        export SCRIPT_PATH=$(pwd)
        __output "      ✅ OK"

header3End



# ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# Install Turbonomic KubeTurbo
# ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
header3Begin "Install Turbonomic KubeTurbo" "rocket"


      __output "Install Turbonomic  KubeTurbo"


        oc create route edge turbonomic-targets -n turbonomic --service=topology-processor --port=http-topology-processor

        oc create ns kubeturbo

        oc create clusterrolebinding kubeturbo-admin --clusterrole=cluster-admin --serviceaccount=kubeturbo:kubeturbo-operator

        oc create -f ./yaml/kubeturbo/service_account.yaml -n kubeturbo
        oc create -f ./yaml/kubeturbo/role_binding.yaml -n kubeturbo
        oc create -f ./yaml/kubeturbo/crds/charts_v1alpha1_kubeturbo_crd.yaml -n kubeturbo
        oc create -f ./yaml/kubeturbo/operator.yaml -n kubeturbo
        oc apply -f ./yaml/kubeturbo/my_kubeturbo_instance_cr.yaml -n kubeturbo


        __output "      ✅ Turbonomic  KubeTurbo Installed"
header3End



